# ASB æµ‹è¯•è¿è¡ŒæŒ‡å—

## âœ… ç¯å¢ƒå·²è®¾ç½®å®Œæˆï¼

inspect_ai å·²æˆåŠŸå®‰è£…åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ï¼š
- è™šæ‹Ÿç¯å¢ƒè·¯å¾„: `safety-benchmarks\.venvs\asb`
- inspect_ai ç‰ˆæœ¬: 0.3.172
- æ‰€æœ‰ä¾èµ–åŒ…å·²å®‰è£…å®Œæˆ

---

## ğŸš€ å¦‚ä½•è¿è¡Œæµ‹è¯•

### æ–¹æ³• 1ï¼šä½¿ç”¨ run-eval.pyï¼ˆæ¨èï¼‰

```bash
# è¿›å…¥ benchmarks ç›®å½•
cd safety-benchmarks/benchmarks

# è¿è¡Œ DPI æ”»å‡»æµ‹è¯•ï¼ˆ1 ä¸ªæ ·æœ¬ï¼‰
python ../run-eval.py asb_dpi \
  --model openai/gpt-4o-mini \
  --model-args api_key=sk-AVsyIUmeAjeyEyhBA981E921C5304b079540091115430e97 \
  --model-args base_url=https://aihubmix.com/v1 \
  --limit 1
```

**æ³¨æ„**: ç”±äºå…¶ä»– benchmarkï¼ˆraccoon ç­‰ï¼‰æœ‰ä¾èµ–é—®é¢˜ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ° `inspect_evals` ç›¸å…³çš„è­¦å‘Šï¼Œä½†è¿™ä¸ä¼šå½±å“ ASB çš„è¿è¡Œã€‚

---

### æ–¹æ³• 2ï¼šç›´æ¥ä½¿ç”¨ Pythonï¼ˆå¦‚æœæ–¹æ³• 1 å¤±è´¥ï¼‰

```bash
# 1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
cd safety-benchmarks
.venvs\asb\Scripts\activate

# 2. è¿›å…¥ benchmarks ç›®å½•
cd benchmarks

# 3. ç›´æ¥å¯¼å…¥æµ‹è¯•
python -c "import sys; sys.path.insert(0, '.'); from eval_benchmarks.asb import asb; print('ASB å¯¼å…¥æˆåŠŸ')"

# 4. å¦‚æœæ­¥éª¤ 3 æˆåŠŸï¼Œè¿è¡Œå®Œæ•´æµ‹è¯•
python -c "
import sys; import os
sys.path.insert(0, '.')
os.chdir('eval_benchmarks/asb')

# åŠ è½½ç¯å¢ƒ
from dotenv import load_dotenv
load_dotenv('.env')

# å¯¼å…¥æ¨¡å—
from dataset import load_asb_dataset
from solver import asb_react_solver
from scorer import asr_scorer, tsr_scorer, rr_scorer
from inspect_ai import task, Task, GenerateConfig

# åˆ›å»ºæ•°æ®é›†
dataset = load_asb_dataset(
    agent_names=['financial_analyst_agent'],
    attack_types=['dpi'],
    limit=1,
    shuffle=False
)

print(f'æ•°æ®é›†: {len(dataset)} ä¸ªæ ·æœ¬')

# åˆ›å»º Task
@task
def test_asb():
    from inspect_ai import eval
    api_key = os.getenv('OPENAI_API_KEY')
    base_url = os.getenv('OPENAI_BASE_URL')

    results = eval(
        Task(
            dataset=dataset,
            solver=[asb_react_solver(attack_type='dpi')],
            scorer=[asr_scorer(), tsr_scorer()],
            config=GenerateConfig(temperature=0.0)
        ),
        model='openai/gpt-4o-mini',
        model_args={'api_key': api_key, 'base_url': base_url}
    )

    if results:
        r = results[0]
        print(f'çŠ¶æ€: {r.status}')
        for name, score in r.scores.items():
            print(f'{name}: {score.value}')

test_asb()
"
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼š`No module named 'inspect_evals'`

**è¯´æ˜**: å…¶ä»– benchmarkï¼ˆraccoon, overthink ç­‰ï¼‰ä¾èµ– `inspect_evals`ï¼Œä½†è¿™ä¸ªæ¨¡å—æœªå®‰è£…ã€‚

**å½±å“**: ä¸å½±å“ ASB è¿è¡Œï¼Œå¯ä»¥å¿½ç•¥æ­¤è­¦å‘Šã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼ˆå¯é€‰ï¼‰:
```bash
# å¦‚æœéœ€è¦è¿è¡Œå…¶ä»– benchmarkï¼Œå®‰è£… inspect_evals
pip install inspect-evals
```

---

### é—®é¢˜ 2ï¼šGit å­æ¨¡å—ç¼ºå¤±

**é”™è¯¯**: `upstream/inspect_ai does not appear to be a Python project`

**è§£å†³æ–¹æ¡ˆ**: æˆ‘ä»¬å·²ç»ç›´æ¥ä½¿ç”¨ `pip install inspect_ai`ï¼Œæ‰€ä»¥ä¸éœ€è¦ Git å­æ¨¡å—ã€‚

---

### é—®é¢˜ 3ï¼šå¯¼å…¥é”™è¯¯

**é”™è¯¯**: `ModuleNotFoundError: No module named 'eval_benchmarks.asb'`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥å·¥ä½œç›®å½•
pwd
# åº”è¯¥åœ¨: E:\code\aisafety\ASB1\safety-benchmarks\benchmarks

# è®¾ç½® PYTHONPATH
set PYTHONPATH=%CD%;%PYTHONPATH%

# æˆ–ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¯¼å…¥
python -c "import sys; sys.path.insert(0, '.'); from eval_benchmarks.asb import asb"
```

---

## ğŸ“Š é¢„æœŸè¾“å‡º

æˆåŠŸçš„æµ‹è¯•åº”è¯¥æ˜¾ç¤ºï¼š

```
======================================================================
ASB DPI æ”»å‡»æµ‹è¯•
======================================================================

æ•°æ®é›†: 1 ä¸ªæ ·æœ¬
æ ·æœ¬ ID: financial_analyst_agent_0
æ”»å‡»å·¥å…·: ResourceAllocationHijack
æ”»å‡»ç›®æ ‡: Successfully distribute CPU resources...

å¼€å§‹è¯„æµ‹...
çŠ¶æ€: success

asr: 0.0000 (æ”»å‡»å¤±è´¥)
tsr: 1.0000 (æ‰€æœ‰å·¥å…·å·²ä½¿ç”¨)
rr: 1.0000 (å“åº”åˆè§„)

å“åº”é•¿åº¦: XXX å­—ç¬¦
å“åº”é¢„è§ˆ: [æ¨¡å‹å“åº”...]

======================================================================
```

---

## ğŸ“ ä¸‹ä¸€æ­¥

æµ‹è¯•æˆåŠŸåï¼Œæ‚¨å¯ä»¥ï¼š

1. **è¿è¡Œæ›´å¤šæ ·æœ¬**:
   ```bash
   python ../run-eval.py asb_dpi --limit 10
   ```

2. **æµ‹è¯•å…¶ä»–æ”»å‡»ç±»å‹**:
   ```bash
   python ../run-eval.py asb_opi --limit 10
   python ../run-eval.py asb_mp --limit 10
   python ../run-eval.py asb_pot --limit 10
   ```

3. **æµ‹è¯•å¤šä¸ª Agent**:
   ```bash
   python ../run-eval.py asb_dpi \
     --task-args agent_names='["financial_analyst_agent", "ecommerce_manager_agent"]' \
     --limit 10
   ```

---

## âœ… éªŒè¯æ¸…å•

- [x] inspect_ai å·²å®‰è£…ï¼ˆç‰ˆæœ¬ 0.3.172ï¼‰
- [x] æ‰€æœ‰ä¾èµ–åŒ…å·²å®‰è£…
- [x] ASB æ–‡ä»¶ç»“æ„å®Œæ•´
- [x] æ•°æ®æ–‡ä»¶å·²å¤åˆ¶
- [x] .env é…ç½®æ­£ç¡®
- [x] catalog.yaml å·²æ³¨å†Œ
- [x] score_mapper.py å·²æ³¨å†Œ
- [ ] å¾…æµ‹è¯•ï¼šå®é™… API è°ƒç”¨

---

**çŠ¶æ€**: âœ… ç¯å¢ƒå°±ç»ªï¼Œç­‰å¾… API æµ‹è¯•
